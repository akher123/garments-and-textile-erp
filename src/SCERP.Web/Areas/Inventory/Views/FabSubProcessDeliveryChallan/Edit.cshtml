@using System.Text.RegularExpressions
@model SCERP.Web.Areas.Maintenance.Models.ReturnableChallanViewModel
@{
    Layout = "~/Views/Shared/_Layout.Dialog.cshtml";
    ViewBag.Title = (Model.ReturnableChallan.ReturnableChallanId > 0 ? "Edit" : "Add");
}
<style type="text/css">
    ul.ui-autocomplete {
        z-index: 1100;
    }
</style>

@using (Html.BeginForm("Save", "FabSubProcessDeliveryChallan", FormMethod.Post, new { @class = "FabSubProcessDeliveryChallan ignore-validation" }))
{
    @Html.HiddenFor(x => x.ReturnableChallan.ReturnableChallanId)
    @Html.HiddenFor(x => x.IsSearch)
    <fieldset>
        <legend>Returnable Challan</legend>

    <table class="tabefont">
        <tr>
            <td></td>
            <td align="left" colspan="7">@Html.Label("Fields with asterisk(*) mark are mandatory", new { @class = "labelInstruction" })</td>
        </tr>
        <tr>
            <td>
                @Html.Label("Ref No :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallan.ReturnableChallanRefId, new {@readonly = "readonly", id = "txtReturnableChallanRefId", style = "background-color: #F0ECE7;"})
            </td>
            <td></td>
            <td>
                @Html.Label("M/S :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallan.Messrs)
            </td>
            <td>
                @Html.Label("*", new {@class = "labelInstruction"})
            </td>
        </tr>
        <tr>
            <td>
                @Html.Label("Address :")
            </td>
            <td>
                @Html.TextAreaFor(x => x.ReturnableChallan.Address)
            </td>
            <td>
                @Html.Label("*", new { @class = "labelInstruction" })
            </td>
            <td>
                @Html.Label("Challan Date :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallan.ChallanDate, new {@class = "datepicker"})
            </td>
            <td>
                @Html.Label("*", new {@class = "labelInstruction"})
            </td>
        </tr>
        <tr>
            <td>
                @Html.Label("Phone :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallan.Phone)
            </td>
            <td>
                @Html.Label("*", new {@class = "labelInstruction"})
            </td>
            <td>
                @Html.Label("Through :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallan.RefferancePerson)
            </td>
            <td>
                @Html.Label("*", new {@class = "labelInstruction"})
            </td>
        </tr>
        <tr>
            <td>
                @Html.Label("Vehicle No :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallan.EmployeeCardId)
            </td>
            <td>
                @Html.Label("*", new { @class = "labelInstruction" })
            </td>
            <td>
                @Html.Label("Department :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallan.Department)
            </td>
            <td>
                @Html.Label("*", new { @class = "labelInstruction" })
            </td>
        </tr>
        <tr>
            <td>
                @Html.Label("Designation :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallan.Designation)
            </td>
            <td>
            </td>
        </tr>

    </table>

        <hr />
    <table class="tabefont" id="returnableChallanDetailInput">
        <tr>

            <td>
                @Html.Label("Buyer :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallanDetail.Buyer)
            </td>
            <td>
                @Html.Label("*", new { @class = "labelInstruction" })
            </td>
            <td>
                @Html.Label("Order :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallanDetail.OrderNo)
            </td>
            <td>
                @Html.Label("*", new { @class = "labelInstruction" })
            </td>
        </tr>
        <tr>

            <td>
                @Html.Label("Style :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallanDetail.StyleNo)
            </td>
            <td>
                @Html.Label("*", new { @class = "labelInstruction" })
            </td>
            <td>
                @Html.Label("Color :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallanDetail.Color)
            </td>
            <td>
                @Html.Label("*", new { @class = "labelInstruction" })
            </td>
        </tr>
        <tr>

            <td>
                @Html.Label("Fabric Type :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallanDetail.ItemName, new { @class = "ItemName" })
            </td>
            <td>
                @Html.Label("*", new {@class = "labelInstruction"})
            </td>
            <td>
                @Html.Label("Unit :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallanDetail.Unit, new { @class = "Unit" })
            </td>
            <td>
                @Html.Label("*", new {@class = "labelInstruction"})
            </td>
        </tr>
        <tr>
            <td>
                @Html.Label("BatchNo :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallanDetail.BatchNo)
            </td>
            <td>
                @Html.Label("*", new {@class = "labelInstruction"})
            </td>
            <td>
                @Html.Label("Roll Qty :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallanDetail.RollQty)
            </td>
            <td>
                @Html.Label("*", new {@class = "labelInstruction"})
            </td>
        </tr>

        <tr>
            <td>
                @Html.Label("Remarks")
            </td>
            <td>
                @Html.TextAreaFor(x => x.ReturnableChallanDetail.Remarks)
            </td>
            <td>

            </td>
            <td>
                @Html.Label("ChallanQty :")
            </td>
            <td>
                @Html.TextBoxFor(x => x.ReturnableChallanDetail.DeliveryQty, new {@class = "deliveryQtyEnterVent", Value = "", @data_val = "false"})
            </td>
            <td>
                @Html.Label("*", new {@class = "labelInstruction"})
            </td>

        </tr>
    </table>

        <hr />


        <table id="returnableChallanDetailListingTable" class="webgrid-table">
            <thead style="text-align: center" class="webgrid-header">
            <tr>
                <th>
                    @Html.Label("Buyer ")
                </th>
                <th>
                    @Html.Label("Order ")
                </th>
                <th>
                    @Html.Label("Style ")
                </th>
                <th>
                    @Html.Label("Color ")
                </th>
                <th>
                    @Html.Label("Fabric Type ")
                </th>
                <th>
                    @Html.Label("Unit ")
                </th>
                <th>
                    @Html.Label("BatchNo ")
                </th>
                <th>
                    @Html.Label("Roll Qty ")
                </th>
                <th>
                    @Html.Label("Remarks")
                </th>
                <th>
                    @Html.Label("ChallanQty ")
                </th>

                <th>
                    @Html.Label("Delete")
                </th>
            </tr>
            </thead>
            <tbody>
    
                @foreach (var m in Model.ReturnableChallanDictionary)
                {
                    <tr id="newRow-@Regex.Replace(Model.ReturnableChallanDictionary[m.Key].ItemName.ToLower(), @"\s+", "")">
                        <td>
                            @Html.DisplayFor(x => x.ReturnableChallanDictionary[m.Key].Buyer)
                            @Html.HiddenFor(x => x.ReturnableChallanDictionary[m.Key].Buyer)
                        </td>
                        <td>
                            @Html.DisplayFor(x => x.ReturnableChallanDictionary[m.Key].OrderNo)
                            @Html.HiddenFor(x => x.ReturnableChallanDictionary[m.Key].OrderNo)
                        </td>
                        <td>
                            @Html.DisplayFor(x => x.ReturnableChallanDictionary[m.Key].StyleNo)
                            @Html.HiddenFor(x => x.ReturnableChallanDictionary[m.Key].StyleNo)
                        </td>
                        <td>
                            @Html.DisplayFor(x => x.ReturnableChallanDictionary[m.Key].Color)
                            @Html.HiddenFor(x => x.ReturnableChallanDictionary[m.Key].Color)
                        </td>
                        <td>
                            @Html.DisplayFor(x => x.ReturnableChallanDictionary[m.Key].ItemName)
                            @Html.HiddenFor(x => x.ReturnableChallanDictionary[m.Key].ItemName)
                            @Html.HiddenFor(x => x.ReturnableChallanDictionary[m.Key].ReturnableChallanId)
                        </td>
                        <td>
                            @Html.DisplayFor(x => x.ReturnableChallanDictionary[m.Key].Unit)
                            @Html.HiddenFor(x => x.ReturnableChallanDictionary[m.Key].Unit)
                        </td>
                        <td>
                            @Html.DisplayFor(x => x.ReturnableChallanDictionary[m.Key].BatchNo)
                            @Html.HiddenFor(x => x.ReturnableChallanDictionary[m.Key].BatchNo)
                        </td>
                        <td>
                            @Html.DisplayFor(x => x.ReturnableChallanDictionary[m.Key].RollQty)
                            @Html.HiddenFor(x => x.ReturnableChallanDictionary[m.Key].RollQty)
                        </td>
                        <td>
                            @Html.DisplayFor(x => x.ReturnableChallanDictionary[m.Key].Remarks)
                            @Html.HiddenFor(x => x.ReturnableChallanDictionary[m.Key].Remarks)
                        </td>
                        <td>
                            @Html.DisplayFor(x => x.ReturnableChallanDictionary[m.Key].DeliveryQty)
                            @Html.HiddenFor(x => x.ReturnableChallanDictionary[m.Key].DeliveryQty)
                        </td>
                        <td>
                            <input type="button" value="X" onclick="deleteRow(this)" />
                        </td>
                    </tr>
                }

            </tbody>

        </table>

        <div class="custom-modal-btn">
            <input type="submit" class="addButton" id="btnSave" value="Save" />
        </div>

    </fieldset>
}

@section scripts
{
    <script>
        $('.deliveryQtyEnterVent').unbind("keypress").bind("keypress", function (e) {
            var key = e.which;
            if (key == 13)  //the enter key code
            {
                e.preventDefault();
                var addNewItem = $('#returnableChallanDetailInput :input');
                var $table = $('table#returnableChallanDetailListingTable tbody');
                var $itemName = $('.ItemName').val();
                var $unit = $('.Unit').val();
                var $deliveryQty = $('.deliveryQtyEnterVent').val();
                var option = {
                    url: "/FabSubProcessDeliveryChallan/AddNewRow/",
                    type: "GET",
                    data: addNewItem.serialize()
                };
                if (jQuery.validator && jQuery.validator.unobtrusive) {
                    addNewItem.validate();
                    if (!addNewItem.valid()) {
                        return false;
                    } else {
                        var message = "";
                        if ($itemName.length <= 0) {
                            message += "Select Item Name.";
                        }
                        if ($unit.length <= 0) {
                            message += "Select Unit Name.";
                        }
                        if ($deliveryQty.length <= 0) {
                            message += "Select delivery Qty Name.";
                        }
                        if (message.length > 0) {
                            alert(message);
                        }
                        else {
                            $.Ajax(option).done(function (htmlResponse) {
                               
                                $table.append(htmlResponse);
                               // $('#newRow-'+$itemName.toLowerCase().replace(/\s+/g, '')).remove();
                                addNewItem.val('');
                                $('.ItemName').focus();
                            });
                        }
                    }

                }

            }

        });

        //$(".deliveryQtyEnterVent").each(function () {
        //    $(this).keyup(function () {
        //        this.value = this.value.replace(/[^0-9]/g, '');
        //    });
        //});

        function deleteRow(buttonObj) {
            var $tr = $(buttonObj).closest("tr");
            $tr.remove();
        }
    </script>
}






