@using SCERP.Common
@model SCERP.Web.Areas.Commercial.Models.ViewModel.LcViewModel

@{
    ViewBag.Title = "LC";
    Layout = "~/Views/Shared/_InventoryLayout.cshtml";
}
@section styles
{
    <link href="~/Content/Common/SingleDropdownMenu.css" rel="stylesheet" />
}
@using (Html.BeginForm("Index", "Lc", FormMethod.Get, new { @class = "lcSearchForm ignore-validation" }))
{
    @Html.HiddenFor(x => x.IsSearch)

    <div class="header-title">
        <h2>LC/Sales Contact Information</h2>
    </div>

    <section class="common-search-section">
        <div class="search formCover common-search-wrapper">
            <table class="tabefont">
                <tr>

                    <td> @Html.Label("Filter : ") </td>
                    <td> @Html.TextBoxFor(x => x.SearchString,new { @placeholder="Filter by LC/SC/UD/EO No"}) </td>
                    <td> @Html.Label("Buyer : ") </td>
                    <td> @Html.DropDownListFor(model => model.BuyerId, Model.BuyerSelectListItem, "-ALL-") </td>
                    <td> @Html.Label("Bank : ") </td>
                    <td> @Html.DropDownListFor(model => model.ReceivingBankId, Model.BankSelectListItem, "-ALL-") </td>
                    <td> @Html.Label("Status: ") </td>
                    <td> @Html.DropDownListFor(model => model.RStatus, Model.StatusSelectListItem) </td>
                    <td>
                        <input type="button" class="searchAction" />

                    </td>
                    <td>
                        <div class="dropdown">
                            <a class="dropbtn custom-table-dropbtn">EXPORT</a>
                            <div class="dropdown-content custom-table-dropdown-content">
                                <a href="#" onclick="javascript: lcStatusReport(1);">Lc Status(PDF)</a>
                                <a href="#" onclick="javascript: lcStatusReport(3);">Lc Status(Excel)</a>
                            </div>
                        </div>
                    </td>
                </tr>
             
            </table>
        </div>
    </section>

}

<section class="search formCover">
    <div class="additem" style="min-height: 200px;padding-bottom:15px;">
        <button class="AjaxPopup addButton" style="float: left" action="/Commercial/Lc/Edit/0">Add New</button>
        <div class="addButton-wrapper">
            <div style="float: right" id="pcscwrapperId">
                <input type="button" id="btnScDtl" class="AjaxPopup addButton" action="" value="Add LC Detail" />
                <input type="button" id="btnPcAmt" class="AjaxPopup addButton" action="" value="Add PC Amount" />
            </div>
        </div>

        @{
            var grid = new WebGrid(canPage: true, rowsPerPage: AppConfig.PageSize, canSort: true, ajaxUpdateContainerId: "grid");
            grid.Bind(Model.VwCommLcInfos, rowCount: Model.TotalRecords, autoSortAndPage: false);
            grid.Pager(WebGridPagerModes.All);
            @grid.GetHtml(htmlAttributes: new { id = "grid" },
                tableStyle: "webgrid-table webgrid",
                headerStyle: "webgrid-header",
                footerStyle: "webgrid-footer",
                alternatingRowStyle: "webgrid-alternating-row",
                selectedRowStyle: "webgrid-selected-row",
                rowStyle: "webgrid-row-style",
                firstText: "First",
                lastText: "Last",
                nextText: "Next",
                mode: WebGridPagerModes.All,
                previousText: "Previous",
                columns: grid.Columns(
                   grid.Column("Report", format: @<text>
                            <div class="dropdown">
                                <a class="dropbtn custom-table-dropbtn">EXPORT</a>
                                <div class="dropdown-content custom-table-dropdown-content">
                                    <a href="/Commercial/Report/LcIndividualDetailReport?LcId=@item.LcId&ReportTyle=1" target="_blank">Detail(PDF)</a>
                                    <a href="/Commercial/Report/LcIndividualDetailReport?LcId=@item.LcId&ReportTyle=3" target="_blank">Detail(Excel)</a>
                                    <a href="/Commercial/Report/LcIndividualDetailReportV2?LcId=@item.LcId&reportType=1" target="_blank">DetailV2(PDF)</a>
                                    <a href="/Commercial/Report/LcIndividualDetailReportV2?LcId=@item.LcId&reportType=3" target="_blank">DetailV2(Excel)</a>
                                    <a href="/Commercial/Report/LcIndividualReport?LcId=@item.LcId&ReportTyle=1" target="_blank">Summary(PDF)</a>
                                    <a href="/Commercial/Report/LcIndividualReport?LcId=@item.LcId&ReportTyle=3" target="_blank">Summary(Excel)</a>
                                </div>
                            </div>
                </text>, canSort: false),
             grid.Column("File", format: @<text><input type="button" class="Edit_Button" action="/Commercial/CommFileUpload/Index?RefId=@item.LcId&SrcType=@Convert.ToInt32(FileSource.SalceContact)" value="Upload" /></text>, canSort: false),
grid.Column("LcNo", header: "LC No", canSort: false),
grid.Column("LcDate", "Date", format: @<text>@(item.LcDate == null ? "" : item.LcDate.ToString("dd-MM-yyyy"))</text>, canSort: false),
grid.Column("BuyerName", "Buyer", format: @<text>@(item.BuyerName == null ? "" : item.BuyerName)</text>, canSort: false),
grid.Column("LcAmount", header: "Amount", canSort: false),
grid.Column("LcQuantity", header: "Quantity", canSort: false),
grid.Column("UdEoNo", header: "UD/EO No", canSort: false),
grid.Column("FileNo", header: "File No", canSort: false),
grid.Column("Status", "Status", format: @<text>@(item.RStatus == "O" ? "OPEN" : "CLOSED")</text>, canSort: false),
grid.Column("PC/SC Dtl", canSort: false, format: @<text> <input type="button" onclick="selectRow('@item.LcId',this)" value="✅" /></text>),

grid.Column("Edit", format: @<text><button class="edit" action="/Commercial/Lc/Edit/@item.LcId"></button></text>, canSort: false),
grid.Column("Delete", format: @<text><button class="delete" action="/Commercial/Lc/Delete/@item.LcId"></button></text>, canSort: false)))
            ;
        }
    </div>
</section>


@section scripts
{
    <script type="text/javascript">

        $('#pcscwrapperId').hide();
        function selectRow(lcId, obj) {
            $('#pcscwrapperId').hide("slow");
            $('#pcscwrapperId').show('slow');
            var button = $(obj);
            var $tr = button.closest('tr');
            $tr.addClass("selected").siblings().removeClass("selected");
            var scUrl = "/Commercial/SalesContact/Index";
            $('#btnScDtl').attr('action', scUrl + "?LcId=" + lcId);

            var pcUrl = "/Commercial/PackingCredit/Index";
            $('#btnPcAmt').attr('action', pcUrl + "?LcId=" + lcId);
        }

        function PrintReport() {

            var buyerId = $('#BuyerId').val();
            var lcType = $('#LcType').val();
            var fromDate = $('#FromDate').val();
            var toDate = $('#ToDate').val();
            var lcIssuingBank = $('#LcIssuingBank').val();
            var receivingBank = $('#ReceivingBank').val();
            var lcNo = $('#LcNo').val();
            window.open("/Commercial/Report/LcListReport?&BuyerId=" + buyerId + "&lcType=" + lcType + "&fromDate=" + fromDate + "&toDate=" + toDate + "&lcIssuingBank=" + lcIssuingBank + "&receivingBank=" + receivingBank + "&lcNo=" + lcNo + "&ExportType=DOC");
        }
        function lcStatusReport(reportTyle) {
            var data = $('.lcSearchForm').serialize();
            var searchurl = '/Commercial/Report/LcStatusReport?' + data+"&reportTyle="+reportTyle;
            window.open(searchurl);
        }

        //function ImportExport() {
        //    var buyerId = $('#buyerIddrd').val();
        //    window.open("/Commercial/Report/ImportExportPerformance?" + "ExportType=DOC&&buyerId=" + buyerId);
        //}

        //function LcWithOrderSummary() {

        //    window.open("/Commercial/Report/CommLcWithOrderSummaryReport?" + "ExportType=DOC");
        //}

        //function LcWithOrderDetail() {

        //    window.open("/Commercial/Report/CommLcWithOrderDetailReport?" + "ExportType=DOC");
        //}

        //function LcWithoutOrder() {

        //    window.open("/Commercial/Report/CommLcWithoutOrderReport?" + "ExportType=DOC");
        //}

        //function OrderWithoutLc() {

        //    window.open("/Commercial/Report/CommOrderWithoutLcReport?" + "ExportType=DOC");
        //}

        //function LcDetail() {

        //    window.open("/Commercial/Report/CommLcDetailReport?" + "ExportType=DOC");
        //}

        //function LcOrderSummary() {

        //    window.open("/Commercial/Report/CommLcOrderSummary?" + "ExportType=DOC");
        //}
    </script>
}
