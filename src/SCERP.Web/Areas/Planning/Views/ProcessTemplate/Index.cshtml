@using SCERP.Common
@model SCERP.Web.Areas.Planning.Models.ViewModels.ProcessTemplateViewModel

@{
    ViewBag.Title = "Process Template";
    Layout = "~/Views/Shared/_Layout2.cshtml";
    var displayStyle = (Model.ProcessTemplate.Count > 0) ? "" : "none";
}

@using (Html.BeginForm("Index", "ProcessTemplate", FormMethod.Get, new {@class = "ProcessTemplateSearchForm submit-allow ignore-validation"}))
{
    @Html.HiddenFor(x => x.IsSearch)
    @Html.HiddenFor(x => x.StylerefId, new { @Class = "BuyerOrderStyleRefId" })

    <div style="width: 400px; padding-left: 340px;">
        <h2>Process Template</h2>
    </div>

    <section class="search formCover" style="margin-bottom: 8px;">
        <table class="tabefont">
                      
            <tr>
                <td>
                    @Html.Label("Style: ")
                </td>
                <td>
                    @Html.TextBoxFor(x => x.SearchString, new { @class = "BuyerStyleSearchByKey", @TClass = "BuyerOrderStyleRefId", @placeholder = "Search key" })
                </td>
                <td>
                    <input type="button" class="searchAction" />
                </td>
            </tr>

        </table>
    </section>
}

<section class="search formCover">
    <div class="additem">
        <div style="margin-bottom: 3px;">
            <button class="AjaxPopup addButton" action="/Planning/ProcessTemplate/Edit">Add New</button>
        </div>
        @{
            var grid = new WebGrid(canPage: true, rowsPerPage: AppConfig.PageSize, canSort: true, ajaxUpdateContainerId: "grid");
            grid.Bind(Model.ProcessTemplate, rowCount: Model.TotalRecords, autoSortAndPage: false);
            grid.Pager(WebGridPagerModes.All);
            @grid.GetHtml(htmlAttributes: new {id = "grid"},
                tableStyle: "webgrid-table webgrid",
                headerStyle: "webgrid-header",
                footerStyle: "webgrid-footer",
                alternatingRowStyle: "webgrid-alternating-row",
                selectedRowStyle: "webgrid-selected-row",
                rowStyle: "webgrid-row-style",
                firstText: "First",
                lastText: "Last",
                nextText: "Next",
                mode: WebGridPagerModes.All,
                previousText: "Previous",
                columns: grid.Columns(

                    grid.Column("OrderStyleRefId", header: "Style No", canSort: false),
                    grid.Column("PLAN_Process.ProcessName", header: "Process Name", format: @<text>@(item.PLAN_Process == null ? "" : item.PLAN_Process.ProcessName)</text>, canSort: false),
                    grid.Column("LeadTime", header: "Lead Time", canSort: false),
                    grid.Column("PlannedStartDate", header: "Start Date", format: @<text>@(item.PlannedStartDate == null ? "" : item.PlannedStartDate.ToString("dd-MM-yyyy") + "\n" + (item.ActualStartDate == null ? "-".PadLeft(5,' ') : item.ActualStartDate.ToString("dd-MM-yyyy")))  </text>, canSort: false),
                    grid.Column("PlannedEndDate", header: "End Date", format: @<text>@(item.PlannedEndDate == null ? "" : item.PlannedEndDate.ToString("dd-MM-yyyy"))</text>, canSort: false),
                    grid.Column("ActualStartDate", header: "Actual Start Date", format: @<text>@(item.ActualStartDate == null ? "" : item.ActualStartDate.ToString("dd-MM-yyyy"))</text>, canSort: false),
                    grid.Column("ActrualEndDate", header: "Actual End Date", format: @<text>@(item.ActrualEndDate == null ? "" : item.ActrualEndDate.ToString("dd-MM-yyyy"))</text>, canSort: false),
                    grid.Column("PLAN_ResponsiblePerson.ResponsiblePersonName", header: "Responsible PersonName", format: @<text>@(item.PLAN_ResponsiblePerson == null ? "" : item.PLAN_ResponsiblePerson.ResponsiblePersonName)</text>, canSort: false),
                    grid.Column("NotifyBeforeDays", header: "Notify Before Days", canSort: false),
                    grid.Column("Remarks", header: "Remarks", canSort: false),
                    grid.Column("Detail/Edit", format: @<text><button class="edit" action="/Planning/ProcessTemplate/Edit/@item.Id"></button></text>, canSort: false),
                    grid.Column("Delete", format: @<text><button class="delete" action="/Planning/ProcessTemplate/Delete/@item.Id"></button></text>, canSort: false)))            
        }
    </div>
</section>

<script type="text/javascript">

    $('.BuyerStyleSearchByKey').on('keyup', function () {
        var tClass = $(this).attr('TClass');
        $(this).autocomplete({
            source: function (request, response) {
                var option = {
                    url: "/OmBuyOrdStyle/StyleAutocomplite",
                    type: "POST",
                    datatype: "html",
                    data: { searchString: request.term },
                };

                $.Ajax(option)
                    .done(function (data) {
                        $('.' + tClass).val('');
                        response($.map(data, function (styleView) {
                            return { label: styleView.StyleName + " " + styleView.OrderStyleRefId + " " + styleView.Quantity, value: styleView.StyleName, StyleRefId: styleView.StyleRefId, OrderStyleRefId: styleView.OrderStyleRefId };
                        }));
                    });
            },
            select: function (event, ui) {
                var styleRefId = ui.item.OrderStyleRefId;
                
                $('.' + tClass).val(styleRefId);
                $('.BuyerOrderStyleRefId').val(styleRefId);
          
            },
        });
    });

</script>





