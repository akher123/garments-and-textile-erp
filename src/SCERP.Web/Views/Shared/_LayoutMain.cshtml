@using System.Collections.Specialized
@using SCERP.Common
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@PortalContext.CurrentUser.CompanyName</title>
    <link rel="shortcut icon" href="~/Content/images/favicon.PNG" />
    <link href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,900" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <style>
        .ui-menu img {
            width: 40px;
            height: 40px;
        }

        .ui-menu li span {
            font-size: 2em;
            padding: 0 0 10px 10px;
            margin: 0 0 10px 0 !important;
            white-space: nowrap;
        }
    </style>
    @Styles.Render("~/Content/css")
    <script src="/Scripts/scerp.constant.js?@(DateTime.Now.Ticks)" type="text/javascript"></script>
    <script type="text/javascript">

        function AJ() {
            var obj;
            if (window.XMLHttpRequest) {
                obj = new XMLHttpRequest();
            }
            else if (window.ActiveXObject) {
                try {
                    obj = new ActiveXObject('MSXML2.XMLHTTP.3.0');
                }
                catch (er) {
                    obj = false;
                }
            }
            return obj;
        }
        //Add keep-alive functionality
        var serverRefreshTimeId;
        function RefreshWindow() {
            var xmlhttp = AJ();
            if (xmlhttp) {
                try {
                    xmlhttp.open("POST", "/Home/RefreshWindow", false);
                    xmlhttp.send();
                }
                catch (er) { }
            }
            serverRefreshTimeId = setTimeout("RefreshWindow()", 300000);
        }
        clearTimeout(serverRefreshTimeId);

    </script>

</head>
<body>
    <script type="text/javascript">serverRefreshTimeId = setTimeout("RefreshWindow()", 300000);</script>
    <div id="main" class="main">

        <div class="top-banner">
            <div class="top-banner-wrapper">
                <img src="~/Content/images/GTex-logo.png" onclick="loadAction('/MisDashboard/SewingProductionBoard')" style="width: 160px; padding:height:200px; 6px 0 0 10px;cursor:pointer;" alt="Logo" />
                
                <span class="topbar-icon" onclick=" toggleNav() ">
                
                    <i id="bars" class="fa fa-bars" aria-hidden="true"></i>
                    <i id="angle" class="fa fa-angle-double-left" style="display: none" aria-hidden="true"></i>
                </span>
            </div>
            <div style="width: 55%; float: right; margin-right: 10px;">
                @if (Request.IsAuthenticated)
                {

                    <div class="topbar-dropdown">
                        <button onclick="dropdown()" class="dropbtn"><img src="@Url.Content(ViewBag.ImageUrl)" style="width: 40px;height:50px;vertical-align: middle;border-radius: 50%;" alt="User" /></button>
                        <div id="dropdownWrap" class="dropdown-content">
                            <a><span class="user-logout-wrapper">@User.Identity.Name</span></a>
                            <a style="cursor: pointer" onclick="loadAction('/UserManagement/User/PassWordChange')">Reset password</a>
                           
                            @Html.ActionLink("Log off", "LogOff", "Home", new { Area = "" }, new { @class = "" })
                        </div>
                    </div>
                    <div id="chat_notitication_template"></div>

                }
            </div>

        </div><div id="menu" class="Menu sidenav">

            @{ Html.RenderAction("Simple", "TreeView", new { area = "" });}
            <div class="footer">
                <div style="font-size: 12px; color: #ffffff;border-top: 1px solid rgba(255, 255, 255, 0.2);width: 100%;padding: 10px 0;">Copyright &copy; @(DateTime.Now.Year) <a href="#" target="_blank" style="color: #ffffff; text-decoration: none;">DhakaSoft Limited</a></div>
            </div>
        </div>


        <div id="contentRight" class="Content" @*style="float: none" *@>

            <div id="cond"></div>


            @RenderBody()
        </div>

        <div id="content-padding-right" class="Menu-Padding"></div>
        @Html.Partial("~/Views/Shared/_ChatBox.cshtml")

    </div>
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/jqueryui")
    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/modernizr")
    @Scripts.Render("~/bundles/others")
    @Scripts.Render("~/bundles/scerp")
    <script src="@Url.Content("~/Scripts/DayPilot/daypilot-all.min.js")" type="text/javascript"></script>
    <script src="~/Scripts/fontawesome.js"></script>
    <script src="~/Scripts/chatBox.js"></script>
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <script src="/signalr/hubs" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
    <script src="~/Scripts/scrollbar.js"></script>

    <!-- Sidebar Nav Script -->
    <script>
        function toggleNav() {
            var x = document.getElementById("menu");
            if (x.style.width === "200px") {
                x.style.width = "0";
            } else {
                x.style.width = "200px";
            }
            var y = document.getElementById("contentRight");
            if (y.style.marginLeft === "200px") {
                y.style.marginLeft = "0";
            } else {
                y.style.marginLeft = "200px";
            }

            var bars = document.getElementById("bars");
            var angle = document.getElementById("angle");

            if (bars.style.display === "none") {
                bars.style.display = "block";
                bars.style.fontSize = "21px";
                bars.style.marginTop = "3px";
                angle.style.display = "none";
            } else {
                bars.style.display = "none";
                angle.style.display = "block";
                angle.style.fontSize = "30px";
            }
        }
    </script>

    <!--Topbar DropDown Script-->
    <script>
        function dropdown() {
            document.getElementById("dropdownWrap").classList.toggle("show");
        }
        window.onclick = function (event) {
            if (!event.target.matches('.dropbtn')) {
                var dropdowns = document.getElementsByClassName("dropdown-content")[0];
                var i;
                for (i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }
    </script>

    <!--Scrollbar script-->
    <script>
        new PerfectScrollbar('#menu');
    </script>

</body>
</html>


<script type="text/javascript">

    // Create a proxy to signalr hub on web server. It reference the hub.
    var notificationFromHub = $.connection.productionHub;
    var chatHub = $.connection.chathub;
    // Connect to signalr hub
    $.connection.hub.start().done(function () {
        FetchEmployees();
        LoadChatNotifications();
    });

    // Notify to client with the recent updates
    notificationFromHub.client.updatedClients = function () {

        FetchEmployees();
    
    };
    function FetchEmployees() {

        $('#cond').load('/MisDashboard/SewingProductionBoard');
    }
    chatHub.client.updatedClients = function () {
        LoadChatNotifications();
    };
    function LoadChatNotifications() {

        $('#chat_notitication_template').load('/Messaging/GetChatMessage');
    }

</script>
